<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>شبیه‌ساز ارز دیجیتال - فونیکس با انیمیشن</title>
<style>
  body { font-family: Tahoma, sans-serif; background: #f9f9f9; text-align:center; padding: 20px; }
  h1 { color: #333; }
  .box { background: #fff; padding: 20px; margin: 20px auto; border-radius: 10px; width: 350px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; transition: transform 0.2s; }

  button:active { transform: scale(1.2); }

  .top-btn { position: fixed; top: 20px; left: 20px; background: teal; color: white; padding: 10px 20px; border-radius: 8px; z-index: 1000; }
  .invite-btn { position: fixed; top: 70px; left: 20px; background: orange; color: white; padding: 10px 20px; border-radius: 8px; z-index: 1000; }
  .delete-btn { position: fixed; top: 120px; left: 20px; background: red; color: white; padding: 10px 20px; border-radius: 8px; z-index: 1000; }

  .top-btn:hover { background: darkcyan; }
  .invite-btn:hover { background: darkorange; }
  .delete-btn:hover { background: darkred; }

  #transactionList {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 250px;
    max-height: 80vh;
    overflow-y: auto;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    padding: 10px;
    text-align: right;
  }
  #transactionList h3 { margin-top: 0; }
  #transactions li { margin-bottom: 5px; font-size: 14px; }

  /* انیمیشن پول */
  .money-animate {
    animation: pulse 0.5s ease;
  }
  @keyframes pulse {
    0% { transform: scale(1); color: teal; }
    50% { transform: scale(1.5); color: green; }
    100% { transform: scale(1); color: teal; }
  }
</style>
</head>
<body>

<h1>شبیه‌ساز ارز دیجیتال - فونیکس</h1>
<p>کاربر: <span id="username"></span></p>

<button class="top-btn" onclick="addDailyMoney()">پول می‌خوام</button>
<button class="invite-btn" onclick="enterInviteCode()">کد دعوت</button>
<button class="delete-btn" onclick="deleteAccount()">پاک کردن حساب</button>

<div class="box">
  <div class="crypto-name">فونیکس (Phoenix)</div>
  <p>قیمت: <span id="pricePhoenix">70</span> تومان</p>
  <button onclick="buy()">خرید</button>
  <button onclick="sell()">فروش</button>
  <p>مقدار شما: <span id="cryptoPhoenix">0</span> واحد</p>
</div>

<div class="box">
  <p>پول شما: <span id="money">0</span> تومان</p>
</div>

<div class="box">
  <h3>نمودار قیمت فونیکس</h3>
  <canvas id="priceChart"></canvas>
</div>

<div id="transactionList">
  <h3>تاریخچه معاملات</h3>
  <ul id="transactions"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
let existingUsers = JSON.parse(localStorage.getItem('existingUsers')) || [];
let username = localStorage.getItem('username');

if(username){
  document.getElementById('username').innerText = username;
} else {
  let newUsername = "";
  do {
    newUsername = prompt("لطفاً نام کاربری خود را وارد کنید:") || "کاربر ناشناس";
    if(existingUsers.includes(newUsername)) alert("این نام کاربری قبلاً استفاده شده است! نام دیگری انتخاب کنید.");
  } while(existingUsers.includes(newUsername) || newUsername==="");

  username = newUsername;
  existingUsers.push(username);
  localStorage.setItem('existingUsers', JSON.stringify(existingUsers));
  localStorage.setItem('username', username);
  document.getElementById('username').innerText = username;
}

let money = parseFloat(localStorage.getItem('money')) || 0;
let cryptoPhoenix = parseInt(localStorage.getItem('cryptoPhoenix')) || 0;
let pricePhoenix = parseFloat(localStorage.getItem('pricePhoenix')) || 70;
let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

function addTransaction(type, amount, price){
  const entry = `${new Date().toLocaleTimeString()} - ${type} ${amount} واحد به قیمت ${price.toFixed(1)}`;
  transactions.push(entry);
  localStorage.setItem('transactions', JSON.stringify(transactions));
  updateTransactionDisplay();
}

function updateTransactionDisplay(){
  const ul = document.getElementById('transactions');
  ul.innerHTML = '';
  transactions.slice(-10).forEach(t => { 
    const li = document.createElement('li');
    li.innerText = t;
    ul.appendChild(li);
  });
}

function animateMoney(){
  const moneyElem = document.getElementById('money');
  moneyElem.classList.remove('money-animate');
  void moneyElem.offsetWidth; // restart animation
  moneyElem.classList.add('money-animate');
}

function updateDisplay(){
  document.getElementById('money').innerText = money.toFixed(1);
  document.getElementById('cryptoPhoenix').innerText = cryptoPhoenix;
  document.getElementById('pricePhoenix').innerText = pricePhoenix.toFixed(1);
  localStorage.setItem('money', money);
  localStorage.setItem('cryptoPhoenix', cryptoPhoenix);
  localStorage.setItem('pricePhoenix', pricePhoenix);
}

const ctx = document.getElementById('priceChart').getContext('2d');
const priceChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [{
      label: 'قیمت فونیکس (تومان)',
      data: [],
      borderColor: 'teal',
      borderWidth: 2,
      tension: 0.4
    }]
  },
  options: { responsive:true, scales:{ x:{title:{display:true,text:'زمان'}}, y:{title:{display:true,text:'قیمت'}} } }
});

function updateChart(price) {
  const now = new Date().toLocaleTimeString();
  priceChart.data.labels.push(now);
  priceChart.data.datasets[0].data.push(price);
  if(priceChart.data.labels.length > 20){ 
    priceChart.data.labels.shift(); 
    priceChart.data.datasets[0].data.shift(); 
  }
  priceChart.update();
}

setInterval(()=>{
  let changePhoenix = (Math.random()*5-2.5); 
  pricePhoenix = Math.max(1, pricePhoenix + changePhoenix);
  updateDisplay();
  updateChart(pricePhoenix);
}, 3500);

function buy(){
  if(money >= pricePhoenix){
    cryptoPhoenix += 1;
    money -= pricePhoenix;
    animateMoney();
    addTransaction('خرید', 1, pricePhoenix);
  } else alert("پول کافی برای خرید فونیکس ندارید!");
  updateDisplay();
}

function sell(){
  if(cryptoPhoenix >= 1){
    cryptoPhoenix -= 1;
    money += pricePhoenix;
    animateMoney();
    addTransaction('فروش', 1, pricePhoenix);
  } else alert("هیچ فونیکسی برای فروش ندارید!");
  updateDisplay();
}

function addDailyMoney(){
  const today = new Date().toDateString();
  const lastClaim = localStorage.getItem('lastClaim') || "";
  if(lastClaim === today){
    alert("امروز قبلاً پول خود را دریافت کرده‌اید. دوباره فردا تلاش کنید!");
  } else {
    money += 10;
    localStorage.setItem('lastClaim', today);
    animateMoney();
    updateDisplay();
    alert("10 تومان روزانه به حساب شما اضافه شد!");
  }
}

function enterInviteCode(){
  const usedInvite1 = JSON.parse(localStorage.getItem('usedInvite1')) || false;
  const usedInvite2 = JSON.parse(localStorage.getItem('usedInvite2')) || false;
  const code = prompt("لطفاً کد دعوت را وارد کنید:");
  if(!code) return;

  if(code === "FONIKS100"){
    if(usedInvite1) alert("کد FONIKS100 فقط یکبار قابل استفاده است!");
    else { money += 100; localStorage.setItem('money', money); localStorage.setItem('usedInvite1', true); animateMoney(); updateDisplay(); alert("100 تومان اضافه شد."); }
  } else if(code === "FONGOL"){
    if(usedInvite2) alert("کد FONGOL فقط یکبار قابل استفاده است!");
    else { money += 10; localStorage.setItem('money', money); localStorage.setItem('usedInvite2', true); animateMoney(); updateDisplay(); alert("10 تومان اضافه شد."); }
  } else alert("کد اشتباه است!");
}

function deleteAccount(){
  if(confirm("آیا مطمئن هستید؟")){
    localStorage.clear();
    alert("حساب شما پاک شد!");
    location.reload();
  }
}

updateDisplay();
updateTransactionDisplay();
</script>

</body>
  </html>
